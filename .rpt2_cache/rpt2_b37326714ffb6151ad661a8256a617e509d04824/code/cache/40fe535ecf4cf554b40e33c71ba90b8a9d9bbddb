{
  "code": "import StaticData from \"../../data/StaticData\";\r\nimport CoinModle from \"../../modle/CoinModle\";\r\nimport SkinModle from \"../../modle/SkinModle\";\r\nimport SkinConfig from \"../../config/CarSkinConfig\";\r\nimport TipsUtil from \"../../utils/TipsUtil\";\r\nimport ConfigData from \"../../config/ConfigData\";\r\nimport WxADUtil from \"../../utils/WxADUtil\";\r\nimport GameManage from \"../GameManage\";\r\nimport BaseDialogManage from \"../dialogManage/BaseDialogManage\";\r\nexport default class ShopManage extends BaseDialogManage {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.carItem = Laya.Box;\r\n        this.eggItem = Laya.Box;\r\n        this.showTab = 0;\r\n        this.eggLocation = [{ x: 353, y: 268 }, { x: 331, y: 280 }, { x: 345, y: 309 }, { x: 363, y: 259 }];\r\n    }\r\n    onEnable() {\r\n        super.onEnable();\r\n        this.selectCarId = SkinModle.selectCarSkinID;\r\n        this.selectEggId = SkinModle.selectEggSkinID;\r\n        this.bg = this.owner.getChildByName(\"bgImg\");\r\n        this.showCarSpr = this.owner.getChildByName(\"showCarSpr\");\r\n        this.showEggSpr = this.owner.getChildByName(\"showEggSpr\");\r\n        this.homeImg = this.owner.getChildByName(\"homeImg\");\r\n        this.eggTabSpr = this.owner.getChildByName(\"eggTabSpr\");\r\n        this.eggLb = this.eggTabSpr.getChildAt(0);\r\n        this.carTabSpr = this.owner.getChildByName(\"carTabSpr\");\r\n        this.carLb = this.carTabSpr.getChildAt(0);\r\n        this.carList = this.owner.getChildByName(\"carList\");\r\n        this.eggList = this.owner.getChildByName(\"eggList\");\r\n        this.initCarList();\r\n        this.initEggList();\r\n        this.hadSpr = this.owner.getChildByName(\"hadSpr\");\r\n        this.havntSpr = this.owner.getChildByName(\"havntSpr\");\r\n        this.freeSpr = this.havntSpr.getChildByName(\"freeSpr\");\r\n        this.buySpr = this.havntSpr.getChildByName(\"buySpr\");\r\n        this.buyCoinLb = this.buySpr.getChildByName(\"buyCoinLb\");\r\n        this.bg.height = StaticData.gameHeight;\r\n        this.homeImg.y += StaticData.offY - 5;\r\n        this.eggTabSpr.y += StaticData.offY - 5;\r\n        this.carTabSpr.y += StaticData.offY - 5;\r\n        this.carList.y += StaticData.offY - 5;\r\n        this.eggList.y += StaticData.offY - 5;\r\n        this.havntSpr.y += StaticData.offY - 5;\r\n        this.hadSpr.y += StaticData.offY - 5;\r\n        this.showCarSpr.y += StaticData.offY - 5;\r\n        this.showEggSpr.y += StaticData.offY - 5;\r\n        if (StaticData.isIphoneX) {\r\n            this.bg.loadImage(\"images/shop_bg.png\");\r\n        }\r\n        this.bindEvent();\r\n        this.showEgg();\r\n    }\r\n    bindEvent() {\r\n        this.homeImg.on(Laya.Event.CLICK, this, this.goHome);\r\n        this.buySpr.on(Laya.Event.CLICK, this, this.buy);\r\n        this.freeSpr.on(Laya.Event.CLICK, this, this.freeGet);\r\n        this.hadSpr.on(Laya.Event.CLICK, this, this.startGame);\r\n        this.eggTabSpr.on(Laya.Event.CLICK, this, this.showEgg);\r\n        this.carTabSpr.on(Laya.Event.CLICK, this, this.showCar);\r\n    }\r\n    initCarList() {\r\n        this.carList.array = SkinModle.getCarSkins();\r\n        this.carList.renderHandler = Laya.Handler.create(this, this.updateCarItem, null, false);\r\n        this.carList.scrollBar.hide = true;\r\n        this.carList.scrollBar.elasticBackTime = 200;\r\n        this.carList.scrollBar.elasticDistance = 20;\r\n    }\r\n    buy() {\r\n        if (this.showTab == 1) {\r\n            this.buyEgg();\r\n        }\r\n        else {\r\n            this.buyCar();\r\n        }\r\n    }\r\n    updateCarItem(cell, index) {\r\n        let skinImg = cell.getChildByName(\"skinSpr\");\r\n        let skinBean = this.carList.array[index];\r\n        skinImg.loadImage(SkinConfig.getCarSkinSmall(skinBean.id));\r\n        let maskSpr = cell.getChildByName(\"maskSpr\");\r\n        maskSpr.visible = !skinBean.hadBuy;\r\n        let isUsed = SkinModle.selectCarSkinID == skinBean.id;\r\n        let usedSpr = cell.getChildByName(\"usedSpr\");\r\n        usedSpr.visible = isUsed;\r\n        let isSelect = (this.selectCarId == skinBean.id);\r\n        let bgSpr = cell.getChildByName(\"bgSpr\");\r\n        bgSpr.loadImage(isSelect ? \"images/shop_select.png\" : \"images/shop_unselect.png\");\r\n        cell.on(Laya.Event.CLICK, this, function () {\r\n            if (skinBean.hadBuy) {\r\n                this.selectCarId = skinBean.id;\r\n                SkinModle.setSelectCarSkinID(this.selectCarId);\r\n                this.carList.refresh();\r\n                this.showCarSkin();\r\n            }\r\n            else {\r\n                this.selectCarId = skinBean.id;\r\n                this.carList.refresh();\r\n                this.showCarSkin();\r\n            }\r\n        });\r\n    }\r\n    showCarSkin() {\r\n        let skin = SkinModle.getCarSkinById(this.selectCarId);\r\n        this.showCarSpr.loadImage(SkinConfig.getCarSkinBig(skin.id));\r\n        let offY = StaticData.offY;\r\n        switch (skin.skinModle) {\r\n            case 1:\r\n                this.showEggSpr.pos(this.eggLocation[0].x, this.eggLocation[0].y + offY);\r\n                break;\r\n            case 2:\r\n                this.showEggSpr.pos(this.eggLocation[1].x, this.eggLocation[1].y + offY);\r\n                break;\r\n            case 3:\r\n                this.showEggSpr.pos(this.eggLocation[0].x, this.eggLocation[0].y + offY);\r\n                break;\r\n            case 4:\r\n                this.showEggSpr.pos(this.eggLocation[2].x, this.eggLocation[2].y + offY);\r\n                break;\r\n            case 5:\r\n                this.showEggSpr.pos(this.eggLocation[3].x, this.eggLocation[3].y + offY);\r\n                break;\r\n            default:\r\n                this.showEggSpr.pos(this.eggLocation[0].x, this.eggLocation[0].y + offY);\r\n                break;\r\n        }\r\n        if (skin.hadBuy) {\r\n            this.havntSpr.visible = false;\r\n            this.hadSpr.visible = true;\r\n        }\r\n        else {\r\n            this.havntSpr.visible = true;\r\n            this.hadSpr.visible = false;\r\n            if (skin.getWay == \"sign\") {\r\n                this.buySpr.loadImage(\"images/get_by_sign.png\");\r\n                this.buyCoinLb.visible = false;\r\n            }\r\n            else if (skin.getWay == \"coin\") {\r\n                this.buySpr.loadImage(\"images/btn_32.png\");\r\n                this.buyCoinLb.visible = true;\r\n                this.buyCoinLb.text = skin.coin;\r\n            }\r\n        }\r\n    }\r\n    buyCar() {\r\n        let skin = SkinModle.getCarSkinById(this.selectCarId);\r\n        if (skin.getWay == \"coin\") {\r\n            if (CoinModle.getCoin() >= skin.coin) {\r\n                TipsUtil.msg(\"购买成功\");\r\n                CoinModle.reduceCoin(skin.coin);\r\n                SkinModle.addCarSkin(skin.id);\r\n                SkinModle.setSelectCarSkinID(this.selectCarId);\r\n                this.carList.refresh();\r\n                this.showCarSkin();\r\n            }\r\n            else {\r\n                TipsUtil.msg(\"金币不足\");\r\n            }\r\n        }\r\n        else if (skin.getWay == \"sign\") {\r\n            Laya.Dialog.open(ConfigData.SignDialog);\r\n        }\r\n    }\r\n    initEggList() {\r\n        this.eggList.array = SkinModle.getEggSkins();\r\n        this.eggList.renderHandler = Laya.Handler.create(this, this.updateEggItem, null, false);\r\n        this.eggList.scrollBar.hide = true;\r\n        this.eggList.scrollBar.elasticBackTime = 200;\r\n        this.eggList.scrollBar.elasticDistance = 20;\r\n    }\r\n    updateEggItem(cell, index) {\r\n        let skinImg = cell.getChildByName(\"skinSpr\");\r\n        let skinBean = this.eggList.array[index];\r\n        skinImg.loadImage(SkinConfig.getEggSkinBig(skinBean.id));\r\n        let maskSpr = cell.getChildByName(\"maskSpr\");\r\n        maskSpr.visible = !skinBean.hadBuy;\r\n        let isUsed = SkinModle.selectEggSkinID == skinBean.id;\r\n        let usedSpr = cell.getChildByName(\"usedSpr\");\r\n        usedSpr.visible = isUsed;\r\n        let isSelect = this.selectEggId == skinBean.id;\r\n        let bgSpr = cell.getChildByName(\"bgSpr\");\r\n        bgSpr.loadImage(isSelect ? \"images/shop_select.png\" : \"images/shop_unselect.png\");\r\n        cell.on(Laya.Event.CLICK, this, function () {\r\n            if (skinBean.hadBuy) {\r\n                this.selectEggId = skinBean.id;\r\n                SkinModle.setSelectEggSkinID(skinBean.id);\r\n                this.eggList.refresh();\r\n                this.showEggSkin();\r\n            }\r\n            else {\r\n                this.selectEggId = skinBean.id;\r\n                this.eggList.refresh();\r\n                this.showEggSkin();\r\n            }\r\n        });\r\n    }\r\n    showEggSkin() {\r\n        let skin = SkinModle.getEggSkinById(this.selectEggId);\r\n        this.showEggSpr.loadImage(SkinConfig.getEggSkinSmall(skin.id));\r\n        if (skin.hadBuy) {\r\n            this.havntSpr.visible = false;\r\n            this.hadSpr.visible = true;\r\n        }\r\n        else {\r\n            this.havntSpr.visible = true;\r\n            this.hadSpr.visible = false;\r\n            this.buySpr.loadImage(\"images/btn_32.png\");\r\n            this.buyCoinLb.visible = true;\r\n            this.buyCoinLb.text = skin.coin;\r\n        }\r\n    }\r\n    buyEgg() {\r\n        let skin = SkinModle.getEggSkinById(this.selectEggId);\r\n        if (CoinModle.getCoin() >= skin.coin) {\r\n            TipsUtil.msg(\"购买成功\");\r\n            CoinModle.reduceCoin(skin.coin);\r\n            SkinModle.addEggSkin(skin.id);\r\n            SkinModle.setSelectEggSkinID(this.selectEggId);\r\n            this.eggList.refresh();\r\n            this.showEggSkin();\r\n        }\r\n        else {\r\n            TipsUtil.msg(\"金币不足\");\r\n        }\r\n    }\r\n    showEgg() {\r\n        if (this.showTab == 1) {\r\n            return;\r\n        }\r\n        this.showTab = 1;\r\n        this.carList.visible = false;\r\n        this.eggList.visible = true;\r\n        this.eggTabSpr.loadImage(\"images/shop_btn_bg.png\");\r\n        this.carTabSpr.loadImage(\"images/shop_btn_s_bg.png\");\r\n        this.carLb.alpha = 0.3;\r\n        this.eggLb.alpha = 1;\r\n        this.showCarSkin();\r\n        this.showEggSkin();\r\n    }\r\n    showCar() {\r\n        if (this.showTab == 2) {\r\n            return;\r\n        }\r\n        this.showTab = 2;\r\n        this.carList.visible = true;\r\n        this.eggList.visible = false;\r\n        this.carTabSpr.loadImage(\"images/shop_btn_bg.png\");\r\n        this.carLb.alpha = 1.0;\r\n        this.eggTabSpr.loadImage(\"images/shop_btn_s_bg.png\");\r\n        this.eggLb.alpha = 0.3;\r\n        this.showCarSkin();\r\n        this.showEggSkin();\r\n    }\r\n    goHome() {\r\n        this.owner.close();\r\n        Laya.Dialog.open(ConfigData.StartGameDialog);\r\n    }\r\n    startGame() {\r\n        this.owner.close();\r\n        GameManage.manageOwner.gameStart(true);\r\n    }\r\n    freeGet() {\r\n        WxADUtil.adOrShare({\r\n            success: () => {\r\n                this.getFree();\r\n            }\r\n        });\r\n    }\r\n    getFree() {\r\n        if (this.showTab == 1) {\r\n            SkinModle.freeEggSkinID = this.selectEggId;\r\n        }\r\n        else {\r\n            SkinModle.freeCarSkinID = this.selectCarId;\r\n        }\r\n        this.owner.close();\r\n        GameManage.manageOwner.gameStart(true);\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaModle/melee/src/data/StaticData.ts",
    "E:/LayaModle/melee/src/modle/CoinModle.ts",
    "E:/LayaModle/melee/src/modle/SkinModle.ts",
    "E:/LayaModle/melee/src/config/CarSkinConfig.ts",
    "E:/LayaModle/melee/src/utils/TipsUtil.ts",
    "E:/LayaModle/melee/src/config/ConfigData.ts",
    "E:/LayaModle/melee/src/utils/LeadOutUtil.ts",
    "E:/LayaModle/melee/src/utils/WxADUtil.ts",
    "E:/LayaModle/melee/src/manages/GameManage.ts",
    "E:/LayaModle/melee/src/manages/dialogManage/BaseDialogManage.ts"
  ]
}
