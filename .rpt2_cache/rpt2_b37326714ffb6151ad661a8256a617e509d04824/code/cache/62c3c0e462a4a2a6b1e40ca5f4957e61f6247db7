{
  "code": "import SingtonClass from \"./SingtonClass\";\r\nimport SoundUtil from \"./SoundUtil\";\r\nimport StaticData from \"../data/StaticData\";\r\nimport GamePlatform from \"../adapter/GamePlatform\";\r\nimport ThreePartyUtil from \"./ThreePartyUtil\";\r\nimport OppoADUtil from \"./OppoADUtil\";\r\nexport default class WxADUtil extends SingtonClass {\r\n    static init() {\r\n        if (Laya.Browser.onWeiXin || Laya.Browser.onQQMiniGame) {\r\n            WxADUtil.initVideo();\r\n            if (GamePlatform.platformName == GamePlatform.WX) {\r\n                WxADUtil.initBanner();\r\n                WxADUtil.initStartBanner();\r\n            }\r\n            WxADUtil.initShare();\r\n        }\r\n    }\r\n    static initVideo() {\r\n        let id = Math.floor(Math.random() * this.ads.length);\r\n        WxADUtil.rewardedVideoAd = GamePlatform.platform.createRewardedVideoAd(this.ads[id]);\r\n        WxADUtil.rewardedVideoAd.load();\r\n        WxADUtil.rewardedVideoAd.onClose(res => {\r\n            if (res.isEnded) {\r\n                if (WxADUtil.adOptions != null && WxADUtil.adOptions != undefined && WxADUtil.adOptions.success)\r\n                    WxADUtil.adOptions.success();\r\n            }\r\n            else {\r\n                if (WxADUtil.adOptions != null && WxADUtil.adOptions != undefined && WxADUtil.adOptions.fail)\r\n                    WxADUtil.adOptions.fail();\r\n            }\r\n            SoundUtil.playBgm();\r\n        });\r\n        WxADUtil.rewardedVideoAd.onError(err => {\r\n            console.log(\"ad onError:\", err);\r\n            if (WxADUtil.adOptions != null && WxADUtil.adOptions != undefined && WxADUtil.adOptions.error)\r\n                WxADUtil.adOptions.error();\r\n            SoundUtil.playBgm();\r\n        });\r\n    }\r\n    static initBanner() {\r\n        if (WxADUtil.bannerAD != null) {\r\n            WxADUtil.bannerAD.hide();\r\n            WxADUtil.bannerAD.destroy();\r\n        }\r\n        WxADUtil.bannerAD = GamePlatform.platform.createBannerAd(WxADUtil.bannerObj);\r\n        WxADUtil.bannerAD.offError();\r\n        WxADUtil.bannerAD.offLoad();\r\n        WxADUtil.bannerAD.offResize();\r\n        WxADUtil.bannerAD.onError(err => {\r\n            WxADUtil.loadTime++;\r\n            console.log(\"wx initBanner onError\");\r\n            if (WxADUtil.loadTime <= 3) {\r\n                WxADUtil.initBanner();\r\n            }\r\n        });\r\n        WxADUtil.bannerAD.onLoad(() => {\r\n            WxADUtil.isLoad = true;\r\n        });\r\n        WxADUtil.bannerAD.onResize(() => {\r\n            if (StaticData.isIphoneX) {\r\n                WxADUtil.bannerAD.style.top = wx.getSystemInfoSync().screenHeight - WxADUtil.bannerAD.style.realHeight - (50 / StaticData.clientScale);\r\n            }\r\n            else {\r\n                WxADUtil.bannerAD.style.top = wx.getSystemInfoSync().screenHeight - WxADUtil.bannerAD.style.realHeight;\r\n            }\r\n        });\r\n    }\r\n    static initStartBanner() {\r\n        if (WxADUtil.startBannerAD != null) {\r\n            WxADUtil.startBannerAD.hide();\r\n            WxADUtil.startBannerAD.destroy();\r\n        }\r\n        WxADUtil.startBannerObj.style.width = 600 / StaticData.clientScale;\r\n        WxADUtil.startBannerObj.style.left = (StaticData.gameWidth - 600) / StaticData.clientScale / 2;\r\n        WxADUtil.startBannerAD = GamePlatform.platform.createBannerAd(WxADUtil.startBannerObj);\r\n        WxADUtil.startBannerAD.offError();\r\n        WxADUtil.startBannerAD.offLoad();\r\n        WxADUtil.startBannerAD.offResize();\r\n        WxADUtil.startBannerAD.onError(err => {\r\n            WxADUtil.startLoadTime++;\r\n            if (WxADUtil.startLoadTime <= 3) {\r\n                WxADUtil.initStartBanner();\r\n            }\r\n        });\r\n        WxADUtil.startBannerAD.onLoad(() => {\r\n            WxADUtil.isLoad = true;\r\n        });\r\n        WxADUtil.startBannerAD.onResize(() => {\r\n            if (StaticData.isIphoneX) {\r\n                WxADUtil.startBannerAD.style.top = wx.getSystemInfoSync().screenHeight - WxADUtil.startBannerAD.style.realHeight - (50 / StaticData.clientScale);\r\n            }\r\n            else {\r\n                WxADUtil.startBannerAD.style.top = wx.getSystemInfoSync().screenHeight - WxADUtil.startBannerAD.style.realHeight;\r\n            }\r\n        });\r\n    }\r\n    static initShare() {\r\n        GamePlatform.platform.showShareMenu({\r\n            withShareTicket: true\r\n        });\r\n        GamePlatform.platform.onShareAppMessage(() => {\r\n            if (GamePlatform.platformName == GamePlatform.WX) {\r\n                if (Laya.Browser.onWeiXin) {\r\n                    let id = Math.floor(Math.random() * WxADUtil.WxShareData.length);\r\n                    return {\r\n                        title: WxADUtil.WxShareData[id].title,\r\n                        imageUrlId: WxADUtil.WxShareData[id].id,\r\n                        imageUrl: WxADUtil.WxShareData[id].url,\r\n                    };\r\n                }\r\n            }\r\n        });\r\n    }\r\n    static getADMidleY() {\r\n        if (WxADUtil.bannerAD == null) {\r\n            return 0;\r\n        }\r\n        let top = WxADUtil.bannerAD.style.top;\r\n        let h = WxADUtil.bannerAD.style.realHeight;\r\n        let y = top + h / 2;\r\n        return y * StaticData.clientScale;\r\n    }\r\n    static showBannerAd() {\r\n        if (GamePlatform.platformName == GamePlatform.OPPO) {\r\n            OppoADUtil.showBanner();\r\n        }\r\n        else {\r\n            if (WxADUtil.bannerAD != null) {\r\n                WxADUtil.bannerAD.show();\r\n            }\r\n        }\r\n    }\r\n    static showStartBannerAd() {\r\n        if (GamePlatform.platformName == GamePlatform.OPPO) {\r\n            OppoADUtil.showBanner();\r\n        }\r\n        else {\r\n            if (WxADUtil.startBannerAD != null) {\r\n                WxADUtil.startBannerAD.show();\r\n            }\r\n        }\r\n    }\r\n    static hideBannerAd() {\r\n        if (GamePlatform.platformName == GamePlatform.OPPO) {\r\n            OppoADUtil.hideBanner();\r\n        }\r\n        else {\r\n            if (WxADUtil.bannerAD != null) {\r\n                WxADUtil.bannerAD.hide();\r\n            }\r\n            if (WxADUtil.startBannerAD != null) {\r\n                WxADUtil.startBannerAD.hide();\r\n            }\r\n        }\r\n    }\r\n    static adOrShare(options = {}) {\r\n        if (GamePlatform.platformName == GamePlatform.OPPO) {\r\n            OppoADUtil.video(options);\r\n        }\r\n        else {\r\n            WxADUtil.video(options);\r\n        }\r\n    }\r\n    static video(options = {}) {\r\n        if (GamePlatform.platformName == GamePlatform.WX) {\r\n            if (Laya.Browser.onWeiXin || Laya.Browser.onQQMiniGame) {\r\n                WxADUtil.adOptions = options;\r\n                WxADUtil.rewardedVideoAd.show();\r\n            }\r\n            else {\r\n                options.fail && options.fail();\r\n            }\r\n        }\r\n        else if (GamePlatform.platformName == GamePlatform.IOS || GamePlatform.platformName == GamePlatform.ANDROID) {\r\n            options.type = \"video\";\r\n            ThreePartyUtil.showVdWithCallBack(options);\r\n        }\r\n        else {\r\n            options.success && options.success();\r\n        }\r\n    }\r\n    static share(options = {}) {\r\n        if (GamePlatform.platformName == GamePlatform.WX) {\r\n            if (Laya.Browser.onWeiXin || Laya.Browser.onQQMiniGame) {\r\n                let id = Math.floor(Math.random() * WxADUtil.WxShareData.length);\r\n                GamePlatform.platform.shareAppMessage({\r\n                    title: WxADUtil.WxShareData[id].title,\r\n                    imageUrlId: WxADUtil.WxShareData[id].id,\r\n                    imageUrl: WxADUtil.WxShareData[id].url,\r\n                });\r\n                if (options.success) {\r\n                    GamePlatform.platform.offShow(options.success);\r\n                    GamePlatform.platform.onShow(options.success);\r\n                }\r\n            }\r\n        }\r\n        else if (GamePlatform.platformName == GamePlatform.IOS || GamePlatform.platformName == GamePlatform.ANDROID) {\r\n            options.type = \"share\";\r\n            ThreePartyUtil.showVdWithCallBack(options);\r\n        }\r\n        else {\r\n            options.success && options.success();\r\n        }\r\n    }\r\n}\r\nWxADUtil.isLoad = false;\r\nWxADUtil.maxShowAdTimes = 5;\r\nWxADUtil.loadTime = 0;\r\nWxADUtil.startLoadTime = 0;\r\nWxADUtil.realHeight = 0;\r\nWxADUtil.top = 0;\r\nWxADUtil.ads = [{\r\n        adUnitId: 'adunit-3059d35561628657'\r\n    }, {\r\n        adUnitId: 'adunit-dc964c0a9729e4d9'\r\n    }];\r\nWxADUtil.bannerObj = {\r\n    adUnitId: 'adunit-5da1fd35bf9c4dec',\r\n    style: {\r\n        left: 0,\r\n        top: StaticData.gameHeight - 300,\r\n        width: 750\r\n    },\r\n    adIntervals: 30\r\n};\r\nWxADUtil.startBannerObj = {\r\n    adUnitId: 'adunit-5da1fd35bf9c4dec',\r\n    style: {\r\n        left: 0,\r\n        top: StaticData.gameHeight - 300,\r\n        width: 600\r\n    },\r\n    adIntervals: 30\r\n};\r\nWxADUtil.WxShareData = [{\r\n        title: \"这个坑，你能出来算我输！\",\r\n        url: \"https://mmocgame.qpic.cn/wechatgame/O1rMXa54WwYibS1faszaNQgoRfGKvh3APGZ4ol1WibIfXZzxHdIColibQ1p31sG5A1R/0\",\r\n        id: \"hC6RQAwSRKWO8kEbBW2NNw\"\r\n    },\r\n    {\r\n        title: \"车门已经焊死了，谁也别想下车！\",\r\n        url: \"https://mmocgame.qpic.cn/wechatgame/O1rMXa54WwbPZtf0B4kCewuCwqxj3vqoH1WbfMOVCZesCcTFfLlBOp0suic4J618l/0\",\r\n        id: \"yKhLLPqSSRKFLIQinvzt-g\"\r\n    }, {\r\n        title: \"道路千万条，安全第一条。行车不规范，蛋蛋两行泪~\",\r\n        url: \"https://mmocgame.qpic.cn/wechatgame/O1rMXa54WwYhad1uPHrFQjCZ8kZqm06U27N2rHkHfdKsJPocRcntNmDIzkflcxcJ/0\",\r\n        id: \"nmPzL9e1QZ2VfCc2q-BL2Q\"\r\n    }\r\n];\r\n",
  "references": [
    "E:/LayaModle/melee/src/utils/SingtonClass.ts",
    "E:/LayaModle/melee/src/utils/TipsUtil.ts",
    "E:/LayaModle/melee/src/utils/SoundUtil.ts",
    "E:/LayaModle/melee/src/data/StaticData.ts",
    "E:/LayaModle/melee/src/adapter/GamePlatform.ts",
    "E:/LayaModle/melee/src/utils/ThreePartyUtil.ts",
    "E:/LayaModle/melee/src/utils/OppoADUtil.ts"
  ]
}
