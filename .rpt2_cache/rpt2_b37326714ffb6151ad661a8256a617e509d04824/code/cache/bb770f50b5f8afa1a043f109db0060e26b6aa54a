{
  "code": "import GameManage from \"../GameManage\";\r\nimport StaticData from \"../../data/StaticData\";\r\nimport CoinModle from \"../../modle/CoinModle\";\r\nimport LocalStorageUtil from \"../../utils/LocalStorageUtil\";\r\nimport SkinModle from \"../../modle/SkinModle\";\r\nimport SkinConfig from \"../../config/CarSkinConfig\";\r\nimport WxADUtil from \"../../utils/WxADUtil\";\r\nimport GameHttp from \"../../data/GameHttp\";\r\nimport AldUtil from \"../../utils/AldUtil\";\r\nimport GamePlatform from \"../../adapter/GamePlatform\";\r\nimport BaseDialogManage from \"../dialogManage/BaseDialogManage\";\r\nexport default class AwardDialogManage extends BaseDialogManage {\r\n    onEnable() {\r\n        super.onEnable();\r\n        let coin = Math.floor((StaticData.getLevelData(StaticData.level).stationInfo.x / 100));\r\n        CoinModle.addCoin(CoinModle.isDoubleCoin ? coin * 2 : coin);\r\n        SkinModle.freeCarSkinID = \"0\";\r\n        SkinModle.freeEggSkinID = \"0\";\r\n        CoinModle.doubleCoin(false);\r\n        GameHttp.Instance.endGame();\r\n        AldUtil.stageEnd(true);\r\n        if (Laya.Browser.onWeiXin || Laya.Browser.onQQMiniGame) {\r\n            let open = GamePlatform.openDataContext.createDisplayObject();\r\n            open.postMsg({ command: \"set_score\", score: StaticData.level, station_name: StaticData.level == 0 ? \"出发地\" : StaticData.getLevelData(StaticData.level - 1).stationInfo.name });\r\n        }\r\n        let leadOut = this.owner.getChildByName(\"bottomLeadOut\");\r\n        leadOut.setAldPois(\"\\u901A\\u5173\\u7ED3\\u7B97\\u9875-\\u5BFC\\u51FA\");\r\n        leadOut.init(true);\r\n    }\r\n    findView() {\r\n        this.titleSpr = this.contentSpr.getChildByName(\"titleLb\");\r\n        this.closeLb = this.contentSpr.getChildByName(\"_no\");\r\n        this.getAwardSpr = this.contentSpr.getChildByName(\"getAwardSpr\");\r\n        this.awardLabel = this.contentSpr.getChildByName(\"awardNameLb\");\r\n        this.midleSpr = this.contentSpr.getChildByName(\"midleSpr\");\r\n        this.coinLb = this.contentSpr.getChildByName(\"coinLb\");\r\n    }\r\n    initView() {\r\n        this.closeLb.on(Laya.Event.CLICK, this, this.closeDialog);\r\n        this.getAwardSpr.on(Laya.Event.CLICK, this, this.getAward);\r\n        this.coinLb.visible = false;\r\n        let levelInfo = StaticData.getLevelData(StaticData.level);\r\n        this.awardData = levelInfo.awards;\r\n        if (this.awardData.type == \"carSkin\") {\r\n            let carSkin = SkinModle.getCarSkinById(String(this.awardData.id));\r\n            this.awardLabel.text = \"- \" + carSkin.skinName + \" -\";\r\n            this.midleSpr.loadImage(SkinConfig.getCarSkinBig(carSkin.id), Laya.Handler.create(this, () => {\r\n                this.midleSpr.x = (StaticData.gameWidth - this.midleSpr.width) / 2;\r\n            }));\r\n        }\r\n        else if (this.awardData.type == \"eggSkin\") {\r\n            let eggSkin = SkinModle.getEggSkinById(this.awardData.id);\r\n            this.awardLabel.text = \"- \" + eggSkin.skinName + \" -\";\r\n            this.midleSpr.loadImage(SkinConfig.getEggSkinBig(eggSkin.id), Laya.Handler.create(this, () => {\r\n                this.midleSpr.x = (StaticData.gameWidth - this.midleSpr.width) / 2;\r\n            }));\r\n        }\r\n        this.closeLb.visible = false;\r\n        this.closeLb.fontSize = 30;\r\n        this.closeLb.alpha = 0.3;\r\n        Laya.timer.once(1000, this, function () {\r\n            this.closeLb.visible = true;\r\n        });\r\n        this.scaleBYes(this.getAwardSpr);\r\n    }\r\n    adapterWindow() {\r\n        super.adapterWindow();\r\n        if (StaticData.isIphoneX) {\r\n            this.getAwardSpr.y = 950;\r\n            this.closeLb.y = 1124;\r\n        }\r\n    }\r\n    closeDialog() {\r\n        this.owner.close();\r\n        this.nextLevel();\r\n    }\r\n    getAward() {\r\n        AldUtil.upload(\"\\u901A\\u5173\\u7ED3\\u7B97\\u9875-\\u83B7\\u5F97\\u76AE\\u80A4\");\r\n        WxADUtil.adOrShare({\r\n            success: () => {\r\n                if (this.awardData.type == \"carSkin\") {\r\n                    SkinModle.freeCarSkinID = String(this.awardData.id);\r\n                }\r\n                else if (this.awardData.type == \"eggSkin\") {\r\n                    SkinModle.freeEggSkinID = String(this.awardData.id);\r\n                }\r\n                this.owner.close();\r\n                this.nextLevel();\r\n            }\r\n        });\r\n    }\r\n    nextLevel() {\r\n        StaticData.level += 1;\r\n        if (StaticData.level >= StaticData.levels.length) {\r\n            StaticData.level -= 1;\r\n        }\r\n        LocalStorageUtil.add(StaticData.LEVEL, StaticData.level);\r\n        GameManage.manageOwner.nextLevel();\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaModle/melee/src/utils/TipsUtil.ts",
    "E:/LayaModle/melee/src/data/UserData.ts",
    "E:/LayaModle/melee/src/manages/GameManage.ts",
    "E:/LayaModle/melee/src/data/beans/AwardType.ts",
    "E:/LayaModle/melee/src/config/ConfigData.ts",
    "E:/LayaModle/melee/src/data/StaticData.ts",
    "E:/LayaModle/melee/src/modle/CoinModle.ts",
    "E:/LayaModle/melee/src/utils/LocalStorageUtil.ts",
    "E:/LayaModle/melee/src/modle/SkinModle.ts",
    "E:/LayaModle/melee/src/config/CarSkinConfig.ts",
    "E:/LayaModle/melee/src/utils/LeadOutUtil.ts",
    "E:/LayaModle/melee/src/utils/WxADUtil.ts",
    "E:/LayaModle/melee/src/data/GameHttp.ts",
    "E:/LayaModle/melee/src/runtimes/LeadOutListRunTime.ts",
    "E:/LayaModle/melee/src/utils/AldUtil.ts",
    "E:/LayaModle/melee/src/adapter/GamePlatform.ts",
    "E:/LayaModle/melee/src/manages/dialogManage/BaseDialogManage.ts"
  ]
}
