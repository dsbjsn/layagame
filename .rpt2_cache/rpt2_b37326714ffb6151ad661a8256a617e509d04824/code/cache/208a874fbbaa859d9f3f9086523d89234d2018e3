{
  "code": "import StaticData from \"../../src/data/StaticData\";\r\nimport GameState from \"../data/GameState\";\r\nimport TipsUtil from \"../utils/TipsUtil\";\r\nimport LocalStorageUtil from \"../utils/LocalStorageUtil\";\r\nimport ConfigData from \"../config/ConfigData\";\r\nimport BaseScript from \"../modle/BaseScript\";\r\nimport SoundUtil from \"../utils/SoundUtil\";\r\nimport GameHttp from \"../data/GameHttp\";\r\nimport AldUtil from \"../utils/AldUtil\";\r\nimport DialogModle from \"../modle/DialogModle\";\r\nimport ViewUtil from \"../utils/ViewUtil\";\r\nexport default class GameManage extends BaseScript {\r\n    constructor() {\r\n        super();\r\n        this.reliveTime = 0;\r\n        this.name = \"GameManage\";\r\n        GameManage.manageOwner = this;\r\n    }\r\n    static getManage() {\r\n        return GameManage.manageOwner;\r\n    }\r\n    onEnable() {\r\n        this.findView();\r\n        this.initView();\r\n        Laya.Dialog.open(ConfigData.StartGameDialog, true, null, Laya.Handler.create(this, (dialog) => {\r\n            let getCoinDate = LocalStorageUtil.getString(\"getCoinDate\");\r\n            let date = new Date();\r\n            let today_date = String(date.getDate());\r\n            if (getCoinDate && getCoinDate != today_date) {\r\n                let d = dialog;\r\n                Laya.timer.once(500, this, () => {\r\n                    if (d && !d.destroyed && d.visible) {\r\n                        Laya.Dialog.open(ConfigData.FLBoxDialog);\r\n                        LocalStorageUtil.add(\"getCoinDate\", today_date);\r\n                    }\r\n                });\r\n            }\r\n            else if (getCoinDate == null) {\r\n                LocalStorageUtil.add(\"getCoinDate\", today_date);\r\n            }\r\n        }));\r\n    }\r\n    onUpdate() {\r\n        if (DialogModle.getDialogCount() > 0) {\r\n            ViewUtil.goneViews([this.leadOut, this.pauseSpr]);\r\n        }\r\n        else {\r\n            ViewUtil.visibleViews([this.leadOut, this.pauseSpr]);\r\n        }\r\n    }\r\n    findView() {\r\n        this.leadOut = this.owner.getChildByName(\"bottomLeadOut\");\r\n        this.pauseSpr = this.owner.getChildByName(\"pauseSpr\");\r\n        this.gameBox = this.owner.getChildByName(\"gameBox\");\r\n    }\r\n    initView() {\r\n        this.pauseSpr.on(Laya.Event.CLICK, this, this.clickAction);\r\n        this.leadOut.setAldPois(\"\\u6E38\\u620F\\u9875-\\u5BFC\\u51FA\");\r\n        this.leadOut.init(true);\r\n        Laya.Physics.I.worldRoot = this.gameBox;\r\n    }\r\n    adapterWindow() {\r\n        ViewUtil.adapterPositionJL(this.pauseSpr);\r\n    }\r\n    gameStart(isNewGame, startAction) {\r\n        console.log(\"开始游戏\");\r\n        if (isNewGame) {\r\n            GameHttp.Instance.startGame();\r\n            AldUtil.stageStart();\r\n            if (startAction != null) {\r\n                switch (startAction) {\r\n                    case ConfigData.FreeSkinOfStartDialog:\r\n                        Laya.Dialog.open(ConfigData.FreeSkinOfStartDialog, false);\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n            else {\r\n                SoundUtil.playStartGame();\r\n                this.gameState = GameState.START;\r\n            }\r\n        }\r\n        else {\r\n            this.gameState = GameState.START;\r\n        }\r\n    }\r\n    gamePause() {\r\n        console.log(\"暂停游戏\");\r\n        this.gameState = GameState.PUASE;\r\n    }\r\n    gameFinish() {\r\n        console.log(\"游戏关卡完成\");\r\n        this.gameState = GameState.FINISH;\r\n        if (StaticData.level >= StaticData.levels.length - 1) {\r\n            TipsUtil.msg(\"恭喜完成全部关卡\");\r\n        }\r\n        else {\r\n            Laya.Dialog.open(ConfigData.AwardDialog);\r\n            this.reliveTime = 0;\r\n        }\r\n    }\r\n    gameOver() {\r\n        if (this.gameState == GameState.OVER || this.gameState == GameState.FINISH) {\r\n            return;\r\n        }\r\n        console.log(\"游戏结束\");\r\n        if (StaticData.allowDie) {\r\n            this.gameState = GameState.OVER;\r\n            if (this.reliveTime >= ConfigData.MaxReLiveTime) {\r\n                this.reliveTime = 0;\r\n                Laya.Dialog.open(ConfigData.GetCoinTimesDialog);\r\n            }\r\n            else {\r\n                Laya.Dialog.open(ConfigData.GameOverDialog);\r\n            }\r\n        }\r\n    }\r\n    restart(showDialog) {\r\n        console.log(\"重新开始\");\r\n        this.refreshUI();\r\n        this.reliveTime = 0;\r\n        if (showDialog) {\r\n            this.gameStart(true, ConfigData.FreeSkinOfStartDialog);\r\n        }\r\n        else {\r\n            this.gameStart(true);\r\n        }\r\n    }\r\n    refreshUI() {\r\n        console.log(\"刷新界面\");\r\n    }\r\n    nextLevel() {\r\n        console.log(\"开始下一关游戏\");\r\n        this.gameStart(true);\r\n    }\r\n    reLive() {\r\n        console.log(\"reLive\");\r\n        this.reliveTime++;\r\n        this.gameStart(false);\r\n    }\r\n    mouseHandle(e) {\r\n        switch (e.type) {\r\n            case Laya.Event.MOUSE_DOWN:\r\n                break;\r\n            case Laya.Event.MOUSE_UP:\r\n                break;\r\n        }\r\n    }\r\n    clickAction(e) {\r\n        switch (e.target.name) {\r\n            case \"pauseSpr\":\r\n                Laya.Dialog.open(ConfigData.PauseDialog);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaModle/melee/src/data/StaticData.ts",
    "E:/LayaModle/melee/src/data/GameState.ts",
    "E:/LayaModle/melee/src/utils/TipsUtil.ts",
    "E:/LayaModle/melee/src/utils/LocalStorageUtil.ts",
    "E:/LayaModle/melee/src/data/beans/AwardType.ts",
    "E:/LayaModle/melee/src/manages/dialogManage/AwardDialogManage.ts",
    "E:/LayaModle/melee/src/config/ConfigData.ts",
    "E:/LayaModle/melee/src/modle/CoinModle.ts",
    "E:/LayaModle/melee/src/modle/BaseScript.ts",
    "E:/LayaModle/melee/src/modle/SkinModle.ts",
    "E:/LayaModle/melee/src/utils/SoundUtil.ts",
    "E:/LayaModle/melee/src/data/GameHttp.ts",
    "E:/LayaModle/melee/src/config/CarSkinConfig.ts",
    "E:/LayaModle/melee/src/runtimes/LeftRightPrefabRunTime.ts",
    "E:/LayaModle/melee/src/runtimes/UpDownPrefabRunTime.ts",
    "E:/LayaModle/melee/src/runtimes/InvisiblePrefabRunTime.ts",
    "E:/LayaModle/melee/src/utils/AldUtil.ts",
    "E:/LayaModle/melee/src/runtimes/LeadOutListRunTime.ts",
    "E:/LayaModle/melee/src/adapter/GamePlatform.ts",
    "E:/LayaModle/melee/src/modle/DialogModle.ts",
    "E:/LayaModle/melee/src/utils/ViewUtil.ts"
  ]
}
